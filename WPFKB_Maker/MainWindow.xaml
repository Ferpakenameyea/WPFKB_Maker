<Window x:Class="WPFKB_Maker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WPFKB_Maker"
        mc:Ignorable="d"
        Title="MainWindow" Height="800" Width="788"
        MinHeight="450"
        MinWidth="800"
        KeyDown="HandleKeyDown"
    xmlns:theme="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Aero2">
    <Window.Resources>
        <Style x:Key="BottomStatusItem" TargetType="StatusBarItem" BasedOn="{StaticResource {x:Type StatusBarItem}}">
            <Setter Property="BorderThickness" Value="0, 0, 1, 0"></Setter>
            <Setter Property="BorderBrush" Value="Gray"></Setter>
            <Setter Property="FontSize" Value="12"></Setter>
        </Style>
        <SolidColorBrush x:Key="ToolBarButtonHover" Color="#210080FF"/>
        <SolidColorBrush x:Key="ToolBarMenuBorder" Color="#FFB6BDC5"/>
        <SolidColorBrush x:Key="ToolBarSubMenuBackground" Color="#FFEEF5FD"/>
        <SolidColorBrush x:Key="ToolBarHorizontalBackground" Color="#FFE4E4E4"/>
        <SolidColorBrush x:Key="ToolBarVerticalBackground" Color="#FFEEF5FD"/>
        <SolidColorBrush x:Key="ToolBarGripper" Color="#FF6D6D6D"/>
        <SolidColorBrush x:Key="ToolBarToggleButtonHorizontalBackground" Color="LightGray"/>
        <SolidColorBrush x:Key="ToolBarToggleButtonVerticalBackground" Color="LightGray"/>
        <Style x:Key="ToolBarMainPanelBorderStyle" TargetType="{x:Type Border}">
            <Setter Property="Margin" Value="0,0,11,0"/>
            <Setter Property="CornerRadius" Value="3,3,3,3"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Source={x:Static SystemParameters.HighContrast}}" Value="true">
                    <Setter Property="CornerRadius" Value="0,0,0,0"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ToolBarThumbStyle" TargetType="{x:Type Thumb}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Thumb}">
                        <Border Background="Transparent" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                            <Rectangle>
                                <Rectangle.Fill>
                                    <DrawingBrush TileMode="Tile" ViewboxUnits="Absolute" Viewbox="0,0,4,4" ViewportUnits="Absolute" Viewport="0,0,4,4">
                                        <DrawingBrush.Drawing>
                                            <DrawingGroup>
                                                <GeometryDrawing Brush="White" Geometry="M 1 1 L 1 3 L 3 3 L 3 1 z"/>
                                                <GeometryDrawing Brush="{StaticResource ToolBarGripper}" Geometry="M 0 0 L 0 2 L 2 2 L 2 0 z"/>
                                            </DrawingGroup>
                                        </DrawingBrush.Drawing>
                                    </DrawingBrush>
                                </Rectangle.Fill>
                            </Rectangle>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Cursor" Value="SizeAll"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ToolBarHorizontalOverflowButtonStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Background" Value="{StaticResource ToolBarToggleButtonHorizontalBackground}"/>
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="MinWidth" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="0,3,3,0" SnapsToDevicePixels="true">
                            <Canvas HorizontalAlignment="Right" Height="7" Margin="7,2,2,2" SnapsToDevicePixels="true" VerticalAlignment="Bottom" Width="6">
                                <Path Data="M 1 1.5 L 6 1.5" Stroke="White"/>
                                <Path Data="M 0 0.5 L 5 0.5" Stroke="{TemplateBinding Foreground}"/>
                                <Path Data="M 0.5 4 L 6.5 4 L 3.5 7 Z" Fill="White"/>
                                <Path Data="M -0.5 3 L 5.5 3 L 2.5 6 Z" Fill="{TemplateBinding Foreground}"/>
                            </Canvas>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Background" TargetName="Bd" Value="{StaticResource ToolBarButtonHover}"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="Background" TargetName="Bd" Value="{StaticResource ToolBarButtonHover}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Foreground" Value="{StaticResource ToolBarGripper}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Source={x:Static SystemParameters.HighContrast}}" Value="true">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ToolBarVerticalOverflowButtonStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Background" Value="{StaticResource ToolBarToggleButtonVerticalBackground}"/>
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="MinWidth" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="0,0,3,3" SnapsToDevicePixels="true">
                            <Canvas HorizontalAlignment="Right" Height="6" Margin="2,7,2,2" SnapsToDevicePixels="true" VerticalAlignment="Bottom" Width="7">
                                <Path Data="M 1.5 1 L 1.5 6" Stroke="White"/>
                                <Path Data="M 0.5 0 L 0.5 5" Stroke="{TemplateBinding Foreground}"/>
                                <Path Data="M 3.5 0.5 L 7 3.5 L 4 6.5 Z" Fill="White"/>
                                <Path Data="M 3 -0.5 L 6 2.5 L 3 5.5 Z" Fill="{TemplateBinding Foreground}"/>
                            </Canvas>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Background" TargetName="Bd" Value="{StaticResource ToolBarButtonHover}"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="Background" TargetName="Bd" Value="{StaticResource ToolBarButtonHover}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Foreground" Value="{StaticResource ToolBarGripper}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Source={x:Static SystemParameters.HighContrast}}" Value="true">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ToolBarStyle" TargetType="{x:Type ToolBar}">
            <Setter Property="Background" Value="{StaticResource ToolBarHorizontalBackground}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToolBar}">
                        <Grid x:Name="Grid" Margin="3,1,1,1" SnapsToDevicePixels="true">
                            <Grid x:Name="OverflowGrid" HorizontalAlignment="Right">
                                <ToggleButton x:Name="OverflowButton" ClickMode="Press" FocusVisualStyle="{x:Null}" IsChecked="{Binding IsOverflowOpen, Mode=TwoWay, RelativeSource={RelativeSource Mode=TemplatedParent}}" IsEnabled="{TemplateBinding HasOverflowItems}" Style="{StaticResource ToolBarHorizontalOverflowButtonStyle}"/>
                                <Popup x:Name="OverflowPopup" AllowsTransparency="true" Focusable="false" IsOpen="{Binding IsOverflowOpen, RelativeSource={RelativeSource Mode=TemplatedParent}}" Placement="Bottom" PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}" StaysOpen="false">
                                    <theme:SystemDropShadowChrome x:Name="Shdw" Color="Transparent">
                                        <Border x:Name="ToolBarSubMenuBorder" Background="{StaticResource ToolBarSubMenuBackground}" BorderBrush="{StaticResource ToolBarMenuBorder}" BorderThickness="1" RenderOptions.ClearTypeHint="Enabled">
                                            <ToolBarOverflowPanel x:Name="PART_ToolBarOverflowPanel" KeyboardNavigation.DirectionalNavigation="Cycle" FocusVisualStyle="{x:Null}" Focusable="true" Margin="2" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" KeyboardNavigation.TabNavigation="Cycle" WrapWidth="200"/>
                                        </Border>
                                    </theme:SystemDropShadowChrome>
                                </Popup>
                            </Grid>
                            <Border x:Name="MainPanelBorder" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}" Style="{StaticResource ToolBarMainPanelBorderStyle}">
                                <DockPanel KeyboardNavigation.TabIndex="1" KeyboardNavigation.TabNavigation="Local">
                                    <Thumb x:Name="ToolBarThumb" Margin="-3,-1,0,0" Padding="6,5,1,6" Style="{StaticResource ToolBarThumbStyle}" Width="10"/>
                                    <ContentPresenter x:Name="ToolBarHeader" ContentSource="Header" HorizontalAlignment="Center" Margin="4,0,4,0" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="Center"/>
                                    <ToolBarPanel x:Name="PART_ToolBarPanel" IsItemsHost="true" Margin="0,1,2,2" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                </DockPanel>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsOverflowOpen" Value="true">
                                <Setter Property="IsEnabled" TargetName="ToolBarThumb" Value="false"/>
                            </Trigger>
                            <Trigger Property="Header" Value="{x:Null}">
                                <Setter Property="Visibility" TargetName="ToolBarHeader" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="ToolBarTray.IsLocked" Value="true">
                                <Setter Property="Visibility" TargetName="ToolBarThumb" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="HasDropShadow" SourceName="OverflowPopup" Value="true">
                                <Setter Property="Margin" TargetName="Shdw" Value="0,0,5,5"/>
                                <Setter Property="SnapsToDevicePixels" TargetName="Shdw" Value="true"/>
                                <Setter Property="Color" TargetName="Shdw" Value="#71000000"/>
                            </Trigger>
                            <Trigger Property="Orientation" Value="Vertical">
                                <Setter Property="Margin" TargetName="Grid" Value="1,3,1,1"/>
                                <Setter Property="Style" TargetName="OverflowButton" Value="{StaticResource ToolBarVerticalOverflowButtonStyle}"/>
                                <Setter Property="Height" TargetName="ToolBarThumb" Value="10"/>
                                <Setter Property="Width" TargetName="ToolBarThumb" Value="Auto"/>
                                <Setter Property="Margin" TargetName="ToolBarThumb" Value="-1,-3,0,0"/>
                                <Setter Property="Padding" TargetName="ToolBarThumb" Value="5,6,6,1"/>
                                <Setter Property="Margin" TargetName="ToolBarHeader" Value="0,0,0,4"/>
                                <Setter Property="Margin" TargetName="PART_ToolBarPanel" Value="1,0,2,2"/>
                                <Setter Property="DockPanel.Dock" TargetName="ToolBarThumb" Value="Top"/>
                                <Setter Property="DockPanel.Dock" TargetName="ToolBarHeader" Value="Top"/>
                                <Setter Property="HorizontalAlignment" TargetName="OverflowGrid" Value="Stretch"/>
                                <Setter Property="VerticalAlignment" TargetName="OverflowGrid" Value="Bottom"/>
                                <Setter Property="Placement" TargetName="OverflowPopup" Value="Right"/>
                                <Setter Property="Margin" TargetName="MainPanelBorder" Value="0,0,0,11"/>
                                <Setter Property="Background" Value="{StaticResource ToolBarVerticalBackground}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Source={x:Static SystemParameters.HighContrast}}" Value="true">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition MinHeight="46" Height="46"/>
            <RowDefinition MinHeight="200"/>
            <RowDefinition MinHeight="21" Height="21"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0">
            <Menu DockPanel.Dock="Top" Height="20">
                <MenuItem Header="文件">
                    <MenuItem Header="新建项目" Click="NewProjectButtonDown"></MenuItem>
                    <MenuItem Header="保存项目" Click="SaveButtonClick"></MenuItem>
                    <MenuItem Header="另存项目" Click="SaveAnotherPathClick"></MenuItem>
                    <MenuItem Header="项目设置" Click="EditProject"></MenuItem>
                </MenuItem>
                <MenuItem Header="编辑">
                    <MenuItem Header="撤销" Click="UndoClick"></MenuItem>
                    <MenuItem Header="重做" Click="RedoClick"></MenuItem>
                    <MenuItem Header="清空" Click="CleanClick"></MenuItem>
                </MenuItem>
            </Menu>

            <DockPanel DockPanel.Dock="Top">
                <ToolBarTray DockPanel.Dock="Left" Background="#FFF1F1F1">
                    <ToolBar Style="{DynamicResource ToolBarStyle}">
                        <Button Click="NewProjectButtonDown">
                            <TextBlock Text="2" LineStackingStrategy="BlockLineHeight" FontFamily="Wingdings"/>
                        </Button>
                        <Button Click="OpenAnotherProjectButtonDown">
                            <TextBlock Text="0" LineStackingStrategy="BlockLineHeight" FontFamily="Wingdings"/>
                        </Button>
                        <Button Click="SaveButtonClick">
                            <TextBlock Text="&lt;" LineStackingStrategy="BlockLineHeight" FontFamily="Wingdings"/>
                        </Button>
                        <Button Click="EditProject">
                            <TextBlock Text="@" LineStackingStrategy="BlockLineHeight" FontFamily="Webdings"/>
                        </Button>
                        <Button Click="ExportLevel">
                            <TextBlock Text="w" LineStackingStrategy="BlockLineHeight" FontFamily="Webdings"/>
                        </Button>
                    </ToolBar>
                    <ToolBar Style="{DynamicResource ToolBarStyle}">
                        <Button>
                            <TextBlock Text="9" LineStackingStrategy="BlockLineHeight" FontFamily="Webdings"/>
                        </Button>
                        <Button>
                            <TextBlock Text="7" LineStackingStrategy="BlockLineHeight" FontFamily="Webdings"/>
                        </Button>
                        <Button Click="PlayButtonClicked">
                            <TextBlock Text="4" LineStackingStrategy="BlockLineHeight" FontFamily="Webdings"/>
                        </Button>
                        <Button>
                            <TextBlock Text="8" LineStackingStrategy="BlockLineHeight" FontFamily="Webdings"/>
                        </Button>
                        <Button>
                            <TextBlock Text=":" LineStackingStrategy="BlockLineHeight" FontFamily="Webdings"/>
                        </Button>
                    </ToolBar>
                </ToolBarTray>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="250"/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0">
                        <Slider x:Name="zoomSlider" VerticalAlignment="Center" DockPanel.Dock="Left" MinWidth="160" Minimum="0.5" Maximum="12.0" ValueChanged="ZoomChanged"/>
                        <TextBlock x:Name="zoomText" Text="缩放：1.0|12.0" DockPanel.Dock="Left" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </DockPanel>
                    <Grid Grid.Column="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>

                        <ProgressBar x:Name="progressBar" Value="100" Maximum="100" VerticalAlignment="Center" Height="15" Grid.Column="0" Margin="5"/>
                        <Label x:Name="currenStatusLabel" Grid.Column="1" Content="就绪" Padding="0" VerticalAlignment="Center"/>

                    </Grid>
                    <DockPanel Grid.Column="2">

                        <Label Content="模式"/>
                        <ComboBox HorizontalAlignment="Center" VerticalAlignment="Center" Width="50" Height="19" Padding="0" SelectedIndex="2" SelectionChanged="RenderStrategySelectionChanged">
                            <ComboBoxItem Content="1/2" Tag="1/2"/>
                            <ComboBoxItem Content="1/3" Tag="1/3"/>
                            <ComboBoxItem Content="1/4" Tag="1/4"/>
                            <ComboBoxItem Content="1/6" Tag="1/6"/>
                            <ComboBoxItem Content="1/8" Tag="1/8"/>
                            <ComboBoxItem Content="1/12" Tag="1/12"/>
                            <ComboBoxItem Content="1/16" Tag="1/16"/>
                            <ComboBoxItem Content="1/24" Tag="1/24"/>
                            <ComboBoxItem Content="1/32" Tag="1/32"/>
                        </ComboBox>

                    </DockPanel>
                    <DockPanel Grid.Column="3">
                        <Label Content="音量"></Label>
                        <Slider VerticalAlignment="Center" ValueChanged="VolumeChanged" Minimum="0.0" Maximum="1.0" Value="1.0"></Slider>
                    </DockPanel>
                </Grid>
            </DockPanel>
        </DockPanel>

        <GridSplitter Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Height="1" Background="Transparent" IsEnabled="False"></GridSplitter>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="19*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" BorderBrush="Black" BorderThickness="0,1,1,1" Background="Black" x:Name="scrollerBorder">
                <Grid>
                    <Image Name="scrollerImage" Stretch="Fill"/>
                    <Image Name="scrollerLineImage" Stretch="Fill" 
               MouseDown="ScrollerLineImageMouseDown"
               MouseMove="ScrollerLineImageMouseMove"
               MouseUp="ScrollerLineImageMouseUp"
               MouseLeave="ScrollerLineImageMouseLeave"/>
                </Grid>
            </Border>

            <Border Grid.Column="1" BorderBrush="Black" BorderThickness="0,1,1,1" Name="rendererBorder">
                <ScrollViewer HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden">
                    <Canvas Name="imageCanvas" 
                            MouseWheel="ScrollSheetRenderer" 
                            MouseDown="CanvasMouseDown"
                            MouseUp="CanvasMouseUp"
                            MouseMove="CanvasMouseMove">
                        <Image x:Name="renderer" Stretch="Uniform"/>
                        <Rectangle x:Name="draggingBox" Fill="#6646A8F7" Stroke="#9917A4CB" Visibility="Hidden"/>
                    </Canvas>
                </ScrollViewer>
            </Border>

            <Border Grid.Column="2" BorderBrush="Black" BorderThickness="0,1,1,1">
                <StackPanel>
                    <ToggleButton x:Name="hitModeButton" Content="HIT" Height="30"/>
                    <ToggleButton x:Name="holdModeButton" Content="HOLD" Height="30"/>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Grid.Row="2">
            <StatusBar>
                <StatusBarItem Name="versionBox" Style="{StaticResource BottomStatusItem}">KBMakerWPF 版本</StatusBarItem>
                <StatusBarItem Name="projectName" Style="{StaticResource BottomStatusItem}">项目名称</StatusBarItem>
                <StatusBarItem Name="currentBpm" Style="{StaticResource BottomStatusItem}">bpm</StatusBarItem>
                <StatusBarItem Style="{StaticResource BottomStatusItem}">by MC_Daxia1472, TFSGameStudio</StatusBarItem>
            </StatusBar>
        </Grid>
    </Grid>
</Window>
